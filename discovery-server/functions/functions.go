package util

import (
	"encoding/base64"
	"encoding/json"
	"fmt"
	"log"
	"os/exec"

	watcher "discovery_server/watcher"

	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/tools/clientcmd"
)

// var clusterList = []Cluster{
// 	{
// 		Name:       "remote2",
// 		Kubeconfig: "YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VKa2VrTkRRVkl5WjBGM1NVSkJaMGxDUVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUZxUVdwTlUwVjNTSGRaUkZaUlVVUkVRbWh5VFROTmRHTXlWbmtLWkcxV2VVeFhUbWhSUkVVelRtcE5OVTlVWnpWT2VsRjNTR2hqVGsxcVZYaE5WRWt3VFZSVk1FMXFWVEJYYUdOT1RYcFZlRTFVU1hsTlZGVXdUV3BWTUFwWGFrRnFUVk5GZDBoM1dVUldVVkZFUkVKb2NrMHpUWFJqTWxaNVpHMVdlVXhYVG1oUlJFVXpUbXBOTlU5VVp6Vk9lbEYzVjFSQlZFSm5ZM0ZvYTJwUENsQlJTVUpDWjJkeGFHdHFUMUJSVFVKQ2QwNURRVUZVU1VocWRURjNjWEJDWkhoQmMwWjBkM1ZhWkhWdmEyOURjekpRUTJvNFVsaEpURTluV21oVVlUQUtPSE5rTTJzMk5VOHdXakoxZFdrNWMyZGFXUzlDYXpGS1EwSlZRMDVEUW05d05tWjZkRFo2TWpRd1VubHZNRWwzVVVSQlQwSm5UbFpJVVRoQ1FXWTRSUXBDUVUxRFFYRlJkMFIzV1VSV1VqQlVRVkZJTDBKQlZYZEJkMFZDTDNwQlpFSm5UbFpJVVRSRlJtZFJWVEJhVG5OT1UzcEhTREkwTlVaR1pqWldTRnBNQ2taU1lYRnFUVVYzUTJkWlNVdHZXa2w2YWpCRlFYZEpSRk5CUVhkU1VVbG9RVXMwT0cxUmNXcEpSV0ZWT0VjM1dXMHJUMGxKZVhOa05HcHpUMUZuUzFVS1ZsbzRhR05FYm1GQkwxSlRRV2xDZDBneWVuSlFWVEo1VVdWVk9EWmtRMFF5YzNJdloxVmlXR001UjJSb1NYbHlUa2QzWTFCUFZFcEZkejA5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTkyLjE2OC4xMS44NDo2NDQzCiAgbmFtZTogZGVmYXVsdApjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogZGVmYXVsdAogICAgdXNlcjogZGVmYXVsdAogIG5hbWU6IGRlZmF1bHQKY3VycmVudC1jb250ZXh0OiBkZWZhdWx0CmtpbmQ6IENvbmZpZwpwcmVmZXJlbmNlczoge30KdXNlcnM6Ci0gbmFtZTogZGVmYXVsdAogIHVzZXI6CiAgICBjbGllbnQtY2VydGlmaWNhdGUtZGF0YTogTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSnJWRU5EUVZSbFowRjNTVUpCWjBsSlVUSjFVRW8zV0ZSUFJWVjNRMmRaU1V0dldrbDZhakJGUVhkSmQwbDZSV2hOUWpoSFFURlZSVUYzZDFrS1lYcE9la3hYVG5OaFYxWjFaRU14YWxsVlFYaE9lbGw2VDFSck5FOVVZekJOUWpSWVJGUkpNVTFVUlhsT1JFVXhUa1JKTVU1R2IxaEVWRWt5VFZSRmVRcE9SRVV4VGtSSk1VNUdiM2ROUkVWWVRVSlZSMEV4VlVWRGFFMVBZek5zZW1SSFZuUlBiVEZvWXpOU2JHTnVUWGhHVkVGVVFtZE9Wa0pCVFZSRVNFNDFDbU16VW14aVZIQm9Xa2N4Y0dKcVFscE5RazFIUW5seFIxTk5ORGxCWjBWSFEwTnhSMU5OTkRsQmQwVklRVEJKUVVKR05WSkNPV0V3VkRBd05IaDRSRllLVkZWQmF6QlhWMUJDT1ZOWFVGVXJObWRtUkV4eGVUaG9ORkJuZFVOUFZWbFZOa3hQVFZWU1FVd3JjRW93TlhkcE0zWk5aWGRFYUhGcU1YcHlhVVpyV2dwaFpXRmtPRmxUYWxORVFrZE5RVFJIUVRGVlpFUjNSVUl2ZDFGRlFYZEpSbTlFUVZSQ1owNVdTRk5WUlVSRVFVdENaMmR5UW1kRlJrSlJZMFJCYWtGbUNrSm5UbFpJVTAxRlIwUkJWMmRDVkZwR1FXMVdha2RUWm1sbmJtVlhSbXRDZVUxVlF6UTBiWEpSYWtGTFFtZG5jV2hyYWs5UVVWRkVRV2RPU1VGRVFrWUtRV2xDUnpSclVHVXJkVVIxWnpWM2N6QTFjV1JYUVZWQmREVkhTM2xXU1hJMVMzUlhRVXhGWWpNd0wzSkpRVWxvUVVsdk4yOXJUWGt2ZG5CUVkzUkRjQW8yYjNjeFZXWkNjMUZOVlhWaVVuZFNWR2t4VEVOeFl5dE9kemt4Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSmtla05EUVZJeVowRjNTVUpCWjBsQ1FVUkJTMEpuWjNGb2EycFBVRkZSUkVGcVFXcE5VMFYzU0hkWlJGWlJVVVJFUW1oeVRUTk5kRmt5ZUhBS1dsYzFNRXhYVG1oUlJFVXpUbXBOTlU5VVp6Vk9lbEYzU0doalRrMXFWWGhOVkVrd1RWUlZNRTFxVlRCWGFHTk9UWHBWZUUxVVNYbE5WRlV3VFdwVk1BcFhha0ZxVFZORmQwaDNXVVJXVVZGRVJFSm9jazB6VFhSWk1uaHdXbGMxTUV4WFRtaFJSRVV6VG1wTk5VOVVaelZPZWxGM1YxUkJWRUpuWTNGb2EycFBDbEJSU1VKQ1oyZHhhR3RxVDFCUlRVSkNkMDVEUVVGU2JYYzNSbmh0TUhBelUyaEVkR3BZV1drMU1GQnJaV3hxWkVVeVUwMDVhRTVZU0ZOTU4zbEZaVU1LV1ZCdVNFaHZXRlZOU2tneE1HVTJhM052WkZVd1kyUmpkRWczV2tweE1rc3haelJtYWxobU1FZEtRbFp2TUVsM1VVUkJUMEpuVGxaSVVUaENRV1k0UlFwQ1FVMURRWEZSZDBSM1dVUldVakJVUVZGSUwwSkJWWGRCZDBWQ0wzcEJaRUpuVGxaSVVUUkZSbWRSVlRKU1VVcHNXWGhyYmpSdlNqTnNhRnBCWTJwR0NrRjFUMHB4TUVsM1EyZFpTVXR2V2tsNmFqQkZRWGRKUkZOQlFYZFNVVWxuV1ZkS2QyTmxkRGRWV1ZWblZ6ZFNZWFZ0U21aM1JFTlhXRnBDUW1wNVZYY0tOa3B1WWk4NWMzTkVlRmxEU1ZGRVNDdG9iVmRvUkdkblIxSXlZVkprUlc1VVRXUkxTRkp3VTNWVWRHNTNPVEYxWXpGaU5tTlFTeXRqWnowOUNpMHRMUzB0UlU1RUlFTkZVbFJKUmtsRFFWUkZMUzB0TFMwSwogICAgY2xpZW50LWtleS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJGUXlCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2sxSVkwTkJVVVZGU1VSTlNGQkhkMEpDVFZaRE5FWnlZbXhTZUU1bU1WazVhbWNyUzFKcE9XUkViVWR2TmtOc1VFOWxkbXR2UVc5SFEwTnhSMU5OTkRrS1FYZEZTRzlWVVVSUlowRkZXR3hGU0RGeVVsQlVWR3BJUlU1V1RsRkRWRkphV1RoSU1VcFpPVlEzY1VJNFRYVnlUSGxJWnl0RE5FazFVbWhVYjNNMGVBcFNSVUYyTm10dVZHNURUR1U0ZURkQlQwZHhVRmhQZFVsWFVteHdOWEF6ZUdoQlBUMEtMUzB0TFMxRlRrUWdSVU1nVUZKSlZrRlVSU0JMUlZrdExTMHRMUW89Cg==",
// 		Resources: v1.ResourceList{
// 			v1.ResourceCPU:    *resource.NewQuantity(5, resource.DecimalSI),
// 			v1.ResourceMemory: *resource.NewQuantity(4*1024*1024*1024, resource.BinarySI),
// 			v1.ResourcePods:   *resource.NewQuantity(100, resource.DecimalSI),
// 			"nvidia.com/gpu":  *resource.NewQuantity(1, resource.DecimalSI),
// 		},
// 		Labels: map[string]string{
// 			"country":  "france",
// 			"provider": "liqo",
// 			"city":     "paris",
// 			"hasGPU":   "true",
// 		},
// 		HasNat: false,
// 	},
// 	{
// 		Name:       "remote3",
// 		Kubeconfig: "YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VKa2VrTkRRVkl5WjBGM1NVSkJaMGxDUVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUZxUVdwTlUwVjNTSGRaUkZaUlVVUkVRbWh5VFROTmRHTXlWbmtLWkcxV2VVeFhUbWhSUkVVelRtcE5OVTlVYXpWTlJHZDNTR2hqVGsxcVZYaE5WRWt3VFZSVk1VOUVTVFJYYUdOT1RYcFZlRTFVU1hsTlZGVXhUMFJKTkFwWGFrRnFUVk5GZDBoM1dVUldVVkZFUkVKb2NrMHpUWFJqTWxaNVpHMVdlVXhYVG1oUlJFVXpUbXBOTlU5VWF6Vk5SR2QzVjFSQlZFSm5ZM0ZvYTJwUENsQlJTVUpDWjJkeGFHdHFUMUJSVFVKQ2QwNURRVUZUTm5SMVJUZDRhMVkzVkVoamQyWlZZWGRNYUhwNVVFbDVUMGd3UTJjMkwyWjVOR0pVTmpKd05tVUtRMmRzWm5WYVFraHVkamd4WWpaNFJqZEdSa0ZXV1VVNFZ6Sk1NRXR1UmxwRmEwWktSRkJNZVVOaGJrdHZNRWwzVVVSQlQwSm5UbFpJVVRoQ1FXWTRSUXBDUVUxRFFYRlJkMFIzV1VSV1VqQlVRVkZJTDBKQlZYZEJkMFZDTDNwQlpFSm5UbFpJVVRSRlJtZFJWV1JETDFjM2JEbHFSMWRHVlZSbE5VYzBkRTQwQ25GR1draHZSVEIzUTJkWlNVdHZXa2w2YWpCRlFYZEpSRk5CUVhkU1VVbG5SRk5CUW1abVRXVlZWazlDWldrM09HaGhVbXBVUkN0U1ZHVk9NRVU1YjFBS1ZuUllWMVZLWVc4eVZtTkRTVkZFWjFJMlIyTlRURkp2ZW14M2JXRkZUV2x2Y0RNNE9WQnhVemd5VEc5TVJHaHdaMFpVUldSNmMxbFJVVDA5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTkyLjE2OC4xMS44NTo2NDQzCiAgbmFtZTogZGVmYXVsdApjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogZGVmYXVsdAogICAgdXNlcjogZGVmYXVsdAogIG5hbWU6IGRlZmF1bHQKY3VycmVudC1jb250ZXh0OiBkZWZhdWx0CmtpbmQ6IENvbmZpZwpwcmVmZXJlbmNlczoge30KdXNlcnM6Ci0gbmFtZTogZGVmYXVsdAogIHVzZXI6CiAgICBjbGllbnQtY2VydGlmaWNhdGUtZGF0YTogTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSnJSRU5EUVZSbFowRjNTVUpCWjBsSlFuRXpWR28zVkRkYVZXdDNRMmRaU1V0dldrbDZhakJGUVhkSmQwbDZSV2hOUWpoSFFURlZSVUYzZDFrS1lYcE9la3hYVG5OaFYxWjFaRU14YWxsVlFYaE9lbGw2VDFSck5VOVVRVFJOUWpSWVJGUkpNVTFVUlhsT1JFVXhUbFJuZVU5R2IxaEVWRWt5VFZSRmVRcE9SRVV4VGxSbmVVOUdiM2ROUkVWWVRVSlZSMEV4VlVWRGFFMVBZek5zZW1SSFZuUlBiVEZvWXpOU2JHTnVUWGhHVkVGVVFtZE9Wa0pCVFZSRVNFNDFDbU16VW14aVZIQm9Xa2N4Y0dKcVFscE5RazFIUW5seFIxTk5ORGxCWjBWSFEwTnhSMU5OTkRsQmQwVklRVEJKUVVKTVVtRlhXREpXYXpKMVEwb3lXamdLZG04MVpFRTBXbnBzVFZneGFURk5hakpqVTB0WFZtdFplbTkzVWpsamQyWlNaRWQzTVRaS01USnhPVU5pVG04M1RFMTRORmxuUkRBMVFYTkRiVkZqYVFwemNFVmFTbFpIYWxORVFrZE5RVFJIUVRGVlpFUjNSVUl2ZDFGRlFYZEpSbTlFUVZSQ1owNVdTRk5WUlVSRVFVdENaMmR5UW1kRlJrSlJZMFJCYWtGbUNrSm5UbFpJVTAxRlIwUkJWMmRDVWpSRWQwaHRSa2czZUVoNFNHUnJXVTVrYVRKR1JWVk5PRmRVVkVGTFFtZG5jV2hyYWs5UVVWRkVRV2RPU0VGRVFrVUtRV2xCTkc5NFJIQjBSVEJ6UzFWdVlYZDRZekV3S3pCNE9GcExkSGhsYmtoemNGRnlLMjVyVGxsNVVXcGpkMGxuVG1VeFdrcDRjVGhyUkRVeU0zVk1iZ3BLUzFKWFpGSlZTM1pSYTIxRWNHTnpjMlYyY1ZWb1V5OHZSWGM5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSmxSRU5EUVZJeVowRjNTVUpCWjBsQ1FVUkJTMEpuWjNGb2EycFBVRkZSUkVGcVFXcE5VMFYzU0hkWlJGWlJVVVJFUW1oeVRUTk5kRmt5ZUhBS1dsYzFNRXhYVG1oUlJFVXpUbXBOTlU5VWF6Vk5SR2QzU0doalRrMXFWWGhOVkVrd1RWUlZNVTlFU1RSWGFHTk9UWHBWZUUxVVNYbE5WRlV4VDBSSk5BcFhha0ZxVFZORmQwaDNXVVJXVVZGRVJFSm9jazB6VFhSWk1uaHdXbGMxTUV4WFRtaFJSRVV6VG1wTk5VOVVhelZOUkdkM1YxUkJWRUpuWTNGb2EycFBDbEJSU1VKQ1oyZHhhR3RxVDFCUlRVSkNkMDVEUVVGVGJFNWpkMFZaUzBSSlFYZE1RWEI2VTBsM2VIZFFRMGxsTVdSSk0wNHpNV04zUjNoRFIxVXdkakFLZW5GdlNDOUtOMFpzZVd0cldXSnVOV1JQVXpNclUycEtNelZ1UVRSSVZIVlJaVXBMY2xGdVlYQkdWa052TUVsM1VVUkJUMEpuVGxaSVVUaENRV1k0UlFwQ1FVMURRWEZSZDBSM1dVUldVakJVUVZGSUwwSkJWWGRCZDBWQ0wzcEJaRUpuVGxaSVVUUkZSbWRSVldWQk9FSTFhRklyT0ZJNFVqTmFSMFJZV1hSb0NsSkdSRkJHYXpCM1EyZFpTVXR2V2tsNmFqQkZRWGRKUkZOUlFYZFNaMGxvUVZCUlMwaHZhazFTSzNWWGFrdG5iWFZVU1U1VWFGWk5aRXBoWkVGV1Iyb0tVV3d4Vm1sWlZISTNVWGwyUVdsRlFUTXJVelpoV1dweFJFaG9XRkp0YVVwMlRsVkNRa3RpVjFoRFNtWTNUamRVUVdGNFFYSnpPSE56WmpROUNpMHRMUzB0UlU1RUlFTkZVbFJKUmtsRFFWUkZMUzB0TFMwSwogICAgY2xpZW50LWtleS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJGUXlCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2sxSVkwTkJVVVZGU1VZM1UxTmxRVXhQYWpZM1dXeDFhMEp5UjFCNU5uQk1jbk5pYWpSa1YySndUM2g1ZVdGVGRrVXhabGh2UVc5SFEwTnhSMU5OTkRrS1FYZEZTRzlWVVVSUlowRkZkRVp3V21aYVYxUmhORWx1V201NUsycHNNRVJvYms5VmVHWlhURlY1VUZwNFNYQmFWMUpxVDJwQ1NERjZRamxHTUdKRVdBcHZibGhoY2pCS2N6SnFjM042U0docFFWQlVhME4zUzFwQ2VVdDVhMUpyYkZWUlBUMEtMUzB0TFMxRlRrUWdSVU1nVUZKSlZrRlVSU0JMUlZrdExTMHRMUW89Cg==",
// 		Resources: v1.ResourceList{
// 			v1.ResourceCPU:    *resource.NewQuantity(2, resource.DecimalSI),
// 			v1.ResourceMemory: *resource.NewQuantity(3*1024*1024*1024, resource.BinarySI),
// 			v1.ResourcePods:   *resource.NewQuantity(100, resource.DecimalSI),
// 			"nvidia.com/gpu":  *resource.NewQuantity(0, resource.DecimalSI),
// 		},
// 		Labels: map[string]string{
// 			"country":  "italy",
// 			"provider": "liqo",
// 			"city":     "turin",
// 			"hasGPU":   "false",
// 		},
// 		HasNat: false,
// 	},
// 	{
// 		Name:       "remote4",
// 		Kubeconfig: "YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VKbFJFTkRRVkl5WjBGM1NVSkJaMGxDUVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUZxUVdwTlUwVjNTSGRaUkZaUlVVUkVRbWh5VFROTmRHTXlWbmtLWkcxV2VVeFhUbWhSUkVVelRtcEpOVTE2WnpOTlZHdDNTR2hqVGsxcVZYaE5WRVY1VFVScmVFMVVWVFZYYUdOT1RYcFZlRTFVUlhkTlJHdDRUVlJWTlFwWGFrRnFUVk5GZDBoM1dVUldVVkZFUkVKb2NrMHpUWFJqTWxaNVpHMVdlVXhYVG1oUlJFVXpUbXBKTlUxNlp6Tk5WR3QzVjFSQlZFSm5ZM0ZvYTJwUENsQlJTVUpDWjJkeGFHdHFUMUJSVFVKQ2QwNURRVUZUYlRKT01tMU9iMGhrVEVjcmRWbHRMMFpKTm0xcllWUkhUWEo1WWpWdVUxcE1hSGMyU2xabVJYQUtjalJsVVd4NWFVZFRNVXBxTkdaalIxVlNVVE5qVkV3NU1qZDZhMlpUVTNKVWJWTmhTWGhuV2pabFJFUnZNRWwzVVVSQlQwSm5UbFpJVVRoQ1FXWTRSUXBDUVUxRFFYRlJkMFIzV1VSV1VqQlVRVkZJTDBKQlZYZEJkMFZDTDNwQlpFSm5UbFpJVVRSRlJtZFJWU3Q0YzJONk5VbEhWVlYyVjNkUksyeEZWRUZqQ2xKYVNFa3phM2QzUTJkWlNVdHZXa2w2YWpCRlFYZEpSRk5SUVhkU1owbG9RVkIyWkZSWFMwdHNXR1J4T0V0VkwwOUhhamgxYnk4clVrTnlkWGxXUVdFS09VVjFObVppWTFORVRIQllRV2xGUVdvelRuVndTWEExVUc1b1N6SlZTV1ZMTVN0SlVrVTNVRXhpV0VzeFJrczVNM0ZNV1dwNmRqTkpNMVU5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTkyLjE2OC4xMS45OTo2NDQzCiAgbmFtZTogZGVmYXVsdApjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogZGVmYXVsdAogICAgdXNlcjogZGVmYXVsdAogIG5hbWU6IGRlZmF1bHQKY3VycmVudC1jb250ZXh0OiBkZWZhdWx0CmtpbmQ6IENvbmZpZwpwcmVmZXJlbmNlczoge30KdXNlcnM6Ci0gbmFtZTogZGVmYXVsdAogIHVzZXI6CiAgICBjbGllbnQtY2VydGlmaWNhdGUtZGF0YTogTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSnJWRU5EUVZSbFowRjNTVUpCWjBsSlJVZ3dhV3RVY2poaU1rRjNRMmRaU1V0dldrbDZhakJGUVhkSmQwbDZSV2hOUWpoSFFURlZSVUYzZDFrS1lYcE9la3hYVG5OaFYxWjFaRU14YWxsVlFYaE9lbGw1VDFSTk5FNTZSVFZOUWpSWVJGUkpNVTFVUlhoTmFrRTFUVlJGTVU5V2IxaEVWRWt5VFZSRmVBcE5ha0UxVFZSRk1VOVdiM2ROUkVWWVRVSlZSMEV4VlVWRGFFMVBZek5zZW1SSFZuUlBiVEZvWXpOU2JHTnVUWGhHVkVGVVFtZE9Wa0pCVFZSRVNFNDFDbU16VW14aVZIQm9Xa2N4Y0dKcVFscE5RazFIUW5seFIxTk5ORGxCWjBWSFEwTnhSMU5OTkRsQmQwVklRVEJKUVVKUVZtaDRVSFJPWWpsQlFpc3hhaklLVVdGa1UyMVZUMEo0S3paU1VEaHpjVWMwZHpBeFNHaHpRM1pySzIxV1MwRmhVbWhRTlV0aGFsbHlWa05XVVVWUVNIZEZiMFF3TWtkT01tRkNObWQzUXdwWFpWTlJlbVpYYWxORVFrZE5RVFJIUVRGVlpFUjNSVUl2ZDFGRlFYZEpSbTlFUVZSQ1owNVdTRk5WUlVSRVFVdENaMmR5UW1kRlJrSlJZMFJCYWtGbUNrSm5UbFpJVTAxRlIwUkJWMmRDVWxwdWIyRjZVRFk0TUdkNmVra3lObWN3YzFrd2VsZDNkWEZwVkVGTFFtZG5jV2hyYWs5UVVWRkVRV2RPU1VGRVFrWUtRV2xGUVcxSk1tVjBkM1ZZVDJwVFNHSktTbkkyU0U0dmJtcEtiamtyZUdOSFNHbzBUMUExZG5SeVltaDRTelJEU1VNMFdtZERVMWxWWkdndlNUUnZRUXB2TjJWRVQxY3ZRVEEwYVdvNFZraEZaRVZQYlZCSFdWTm9lVWRJQ2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVSmtha05EUVZJeVowRjNTVUpCWjBsQ1FVUkJTMEpuWjNGb2EycFBVRkZSUkVGcVFXcE5VMFYzU0hkWlJGWlJVVVJFUW1oeVRUTk5kRmt5ZUhBS1dsYzFNRXhYVG1oUlJFVXpUbXBKTlUxNlp6Tk5WR3QzU0doalRrMXFWWGhOVkVWNVRVUnJlRTFVVlRWWGFHTk9UWHBWZUUxVVJYZE5SR3Q0VFZSVk5RcFhha0ZxVFZORmQwaDNXVVJXVVZGRVJFSm9jazB6VFhSWk1uaHdXbGMxTUV4WFRtaFJSRVV6VG1wSk5VMTZaek5OVkd0M1YxUkJWRUpuWTNGb2EycFBDbEJSU1VKQ1oyZHhhR3RxVDFCUlRVSkNkMDVEUVVGU1pFVnNNSGxZTHpCV1RHWTVaV056UlZkWmNWUnNjakJWVVRoWVMweEdlbEJOVTJrdlZETTFaaXNLYmtaVlF6aGpUMnMyTDJsRU0zYzVVazlyVGpkNldXZENSVTFMTXpoak1DOHZWUzlqWmpSdlZtaDVhRFp2TUVsM1VVUkJUMEpuVGxaSVVUaENRV1k0UlFwQ1FVMURRWEZSZDBSM1dVUldVakJVUVZGSUwwSkJWWGRCZDBWQ0wzcEJaRUpuVGxaSVVUUkZSbWRSVlZkYU5rZHplaXQyVGtsTk9IbE9kVzlPVEVkT0NrMHhjMHh4YjJ0M1EyZFpTVXR2V2tsNmFqQkZRWGRKUkZKM1FYZFNRVWxuVW5ReVptazJMM0IzY25BMk4wcGhUbEp1Y0M5b2FFTm5ZVVZ2TmpCWWJtc0thVUZhU0ZwMk9URm9ZMDFEU1VGMlkySmhhR3BKVG5CWmFuSk9SSGRUVFhjdlJFVklkbkZQVmtrMmEzZEhhbEo2ZDBoaGFtbFNhSEFLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89CiAgICBjbGllbnQta2V5LWRhdGE6IExTMHRMUzFDUlVkSlRpQkZReUJRVWtsV1FWUkZJRXRGV1MwdExTMHRDazFJWTBOQlVVVkZTVTVEWnpadVJITjBMM2RvVFdGVkwxSkxhRU5hYldOdFRtVlFiamwwTDAxcWRHdHpORTlRU0RNelJtSnZRVzlIUTBOeFIxTk5ORGtLUVhkRlNHOVZVVVJSWjBGRk9WZElSU3N3TVhZd1FVZzNWMUJhUW5BeFMxcFJORWhJTjNCRkwzbDViMkpxUkZSVlpVZDNTeXRVTmxwVmIwSndSMFV2YXdwd2NVNXBkRlZLVmtGUk9HWkJVMmRRVkZsWk0xcHZTSEZFUVVwYU5VcEVUamxSUFQwS0xTMHRMUzFGVGtRZ1JVTWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRbz0K",
// 		Resources: v1.ResourceList{
// 			v1.ResourceCPU:    *resource.NewQuantity(2, resource.DecimalSI),
// 			v1.ResourceMemory: *resource.NewQuantity(3*1024*1024*1024, resource.BinarySI),
// 			v1.ResourcePods:   *resource.NewQuantity(100, resource.DecimalSI),
// 			"nvidia.com/gpu":  *resource.NewQuantity(0, resource.DecimalSI),
// 		},
// 		Labels: map[string]string{
// 			"country":  "italy",
// 			"provider": "liqo",
// 			"city":     "turin",
// 			"hasGPU":   "false",
// 		},
// 		HasNat: false,
// 	},
// 	{
// 		Name:       "remote5",
// 		Kubeconfig: "YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VKa2VrTkRRVkl5WjBGM1NVSkJaMGxDUVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUZxUVdwTlUwVjNTSGRaUkZaUlVVUkVRbWh5VFROTmRHTXlWbmtLWkcxV2VVeFhUbWhSUkVVelRtcEpOVTE2WnpOTlZGbDNTR2hqVGsxcVZYaE5WRVY1VFVScmVFMVVWVEpYYUdOT1RYcFZlRTFVUlhkTlJHdDRUVlJWTWdwWGFrRnFUVk5GZDBoM1dVUldVVkZFUkVKb2NrMHpUWFJqTWxaNVpHMVdlVXhYVG1oUlJFVXpUbXBKTlUxNlp6Tk5WRmwzVjFSQlZFSm5ZM0ZvYTJwUENsQlJTVUpDWjJkeGFHdHFUMUJSVFVKQ2QwNURRVUZTVVhaeWRVZDRWekkxTkZaMU5YVmhTa1o1YTFwbGJVdFRaMUJUZW1OT1kyMUhjWEpSYVRoaFVWVUtUM0JhYmpoS1RrSnlWSEV6U21aemF6SnZSR1ZCWlVWeVYyWk9UVUZqUTNOTFIyUnlRVU5ZWmtGREsyaHZNRWwzVVVSQlQwSm5UbFpJVVRoQ1FXWTRSUXBDUVUxRFFYRlJkMFIzV1VSV1VqQlVRVkZJTDBKQlZYZEJkMFZDTDNwQlpFSm5UbFpJVVRSRlJtZFJWVEF3UW05QmJITTRUazR2VERSQlQxVTVTVFpxQ25OUU0xSmpiekIzUTJkWlNVdHZXa2w2YWpCRlFYZEpSRk5CUVhkU1VVbG9RVTU0WTA1aFJXcFFjV00zVERsRlpreERjRnBSY1d0bU56ZHBaVlZKTjNnS2QxWm1aV05XTDFBM09YQk9RV2xCWVRWTGJEa3dkMEpJY2xwRlVWQmFZalpFZVRFd1ZrUlliazh2YVhWeFRtaEpWakJ1UlZoR1dHOVpaejA5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTkyLjE2OC4xMS4xMDA6NjQ0MwogIG5hbWU6IGRlZmF1bHQKY29udGV4dHM6Ci0gY29udGV4dDoKICAgIGNsdXN0ZXI6IGRlZmF1bHQKICAgIHVzZXI6IGRlZmF1bHQKICBuYW1lOiBkZWZhdWx0CmN1cnJlbnQtY29udGV4dDogZGVmYXVsdApraW5kOiBDb25maWcKcHJlZmVyZW5jZXM6IHt9CnVzZXJzOgotIG5hbWU6IGRlZmF1bHQKICB1c2VyOgogICAgY2xpZW50LWNlcnRpZmljYXRlLWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVUpyVkVORFFWUmxaMEYzU1VKQlowbEpSalp2THpkWVptOHhiVGgzUTJkWlNVdHZXa2w2YWpCRlFYZEpkMGw2UldoTlFqaEhRVEZWUlVGM2Qxa0tZWHBPZWt4WFRuTmhWMVoxWkVNeGFsbFZRWGhPZWxsNVQxUk5ORTU2UlRKTlFqUllSRlJKTVUxVVJYaE5ha0UxVFZSRk1VNXNiMWhFVkVreVRWUkZlQXBOYWtFMVRWUkZNVTVzYjNkTlJFVllUVUpWUjBFeFZVVkRhRTFQWXpOc2VtUkhWblJQYlRGb1l6TlNiR051VFhoR1ZFRlVRbWRPVmtKQlRWUkVTRTQxQ21NelVteGlWSEJvV2tjeGNHSnFRbHBOUWsxSFFubHhSMU5OTkRsQlowVkhRME54UjFOTk5EbEJkMFZJUVRCSlFVSkJkR054Ym5OSlRHZFBRamhxYzJJS2JrNDRVWGQ2ZEZOSk4wTlZlUzgxWTBKelMyMWxOVVJqVEZOYVRYTnZWMlF5YW1SRlIwOVdjRkpvTVdwTE9EbFpTMjU1T0hOTGVXcFVjbmRUT1ZGcllncHFUVFoyZFRScGFsTkVRa2ROUVRSSFFURlZaRVIzUlVJdmQxRkZRWGRKUm05RVFWUkNaMDVXU0ZOVlJVUkVRVXRDWjJkeVFtZEZSa0pSWTBSQmFrRm1Da0puVGxaSVUwMUZSMFJCVjJkQ1VWWkdkV3hVVkRRNVlUSlVjbnBwWVRKSVJIaDBRbnA0TURNMlZFRkxRbWRuY1docmFrOVFVVkZFUVdkT1NVRkVRa1lLUVdsRlFUVTNTa2h4Tm5CcWVFdDBkRUY1VW1OVVFqWlhWMFpTVDJzNWVqaHljbEZ2WjFoa04yNHhRamRuYTFsRFNVRk5hMnB5U1hZelkyMVFZbGg0VlFwMGEyUmhZU3RKZUVsalQxTjJWV05UUjFObEwwZElRakpsWms0M0NpMHRMUzB0UlU1RUlFTkZVbFJKUmtsRFFWUkZMUzB0TFMwS0xTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVUprYWtORFFWSXlaMEYzU1VKQlowbENRVVJCUzBKblozRm9hMnBQVUZGUlJFRnFRV3BOVTBWM1NIZFpSRlpSVVVSRVFtaHlUVE5OZEZreWVIQUtXbGMxTUV4WFRtaFJSRVV6VG1wSk5VMTZaek5OVkZsM1NHaGpUazFxVlhoTlZFVjVUVVJyZUUxVVZUSlhhR05PVFhwVmVFMVVSWGROUkd0NFRWUlZNZ3BYYWtGcVRWTkZkMGgzV1VSV1VWRkVSRUpvY2swelRYUlpNbmh3V2xjMU1FeFhUbWhSUkVVelRtcEpOVTE2WnpOTlZGbDNWMVJCVkVKblkzRm9hMnBQQ2xCUlNVSkNaMmR4YUd0cVQxQlJUVUpDZDA1RFFVRlVVbWdyUTNacmVWcHRRMVZWS3pKalUzTXpUMWgwYkZaTFlXeFZWSFJJVFhrclIyNDRkR2RtYjNvS2FYb3pkekpTSzNwb1duWmFWRlI2YzBSbVMzUkhjR2w1UWxkS01EVklZbTVzUmtJMWFERnRjelZzZDJOdk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJRcENRVTFEUVhGUmQwUjNXVVJXVWpCVVFWRklMMEpCVlhkQmQwVkNMM3BCWkVKblRsWklVVFJGUm1kUlZVWlNZbkJWTUN0UVYzUnJOamcwYlhSb2R6aGlDbEZqT0dST0sydDNRMmRaU1V0dldrbDZhakJGUVhkSlJGSjNRWGRTUVVsblNHWnllV2Q0TWpKaVMxaDZjbkUxV0dac016bDFhak5qV0RkM09VZE1XbFVLZVRGcFQwMUpTMWt4U0ZsRFNVWmlRV0V3YTJZM00xVlJRazgzVlVnMVpFOUZiVE0zYW1vNVNWTmFhREV5SzA5MVdWTkZPSGQzU0c4S0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvPQogICAgY2xpZW50LWtleS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJGUXlCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2sxSVkwTkJVVVZGU1ZCcUwxSlNkM1J5U25Sb05ESkNLell5V1c1Q1lVMW9aVmxhWm5sUGVVbEJOMDV1UVc1T1N5dE5abFZ2UVc5SFEwTnhSMU5OTkRrS1FYZEZTRzlWVVVSUlowRkZRekY1Y1dWM1ozVkJORWg1VDNoMVl6TjRSRVJQTVVscWMwcFVUQzlzZDBkM2NWbzNhMDUzZEVwcmVYbG9Xak5oVGpCUldRbzFWMnhIU0ZkTmNub3haM0ZtVEhsM2NrdE9UM1pDVERGRFVuVk5lbkVyTjJsQlBUMEtMUzB0TFMxRlRrUWdSVU1nVUZKSlZrRlVSU0JMUlZrdExTMHRMUW89Cg==",
// 		Resources: v1.ResourceList{
// 			v1.ResourceCPU:    *resource.NewQuantity(2, resource.DecimalSI),
// 			v1.ResourceMemory: *resource.NewQuantity(3*1024*1024*1024, resource.BinarySI),
// 			v1.ResourcePods:   *resource.NewQuantity(100, resource.DecimalSI),
// 			"nvidia.com/gpu":  *resource.NewQuantity(0, resource.DecimalSI),
// 		},
// 		Labels: map[string]string{
// 			"country":  "italy",
// 			"provider": "liqo",
// 			"city":     "turin",
// 			"hasGPU":   "false",
// 		},
// 		HasNat: false,
// 	},
// }

type Secret struct {
	Data map[string]string `json:"data"`
}

// type Cluster struct {
// 	Name       string            `json:"name"`
// 	Kubeconfig string            `json:"kubeconfig"`
// 	Resources  v1.ResourceList   `json:"resources"`
// 	Labels     map[string]string `json:"labels"`
// 	HasNat     bool              `json:"hasNat"`
// }

func ReturnList() ([]watcher.Cluster, error) {
	// No existing Nodegroups

	clusterList := watcher.GetClusters()
	if len(clusterList) == 0 {
		return nil, fmt.Errorf("no clusters found")
	} else {
		return clusterList, nil
	}
}
func UpdateList(name string, kubeconfig string, resources int) error {
	// Update the list of remote clusters
	if name == "" || kubeconfig == "" || resources <= 0 {
		return fmt.Errorf("invalid parameters for updating cluster list")
	}

	// Simulate updating the cluster map
	log.Printf("kubeconfig: %s, resources: %d", kubeconfig, resources)
	return nil
}

func TestDecode() error {
	cmd := exec.Command("kubectl", "get", "secret", "mio-secret", "-n", "demo", "-o", "json")
	out, _ := cmd.Output()
	// Parse del JSON del Secret
	var s Secret
	if err := json.Unmarshal(out, &s); err != nil {
		panic(err)
	}

	// Prendo il campo che hai messo tu
	encoded := s.Data["dati"]

	// Decodifico il base64
	decoded, err := base64.StdEncoding.DecodeString(encoded)
	if err != nil {
		panic(err)
	}

	fmt.Println("Contenuto del JSON del Secret:")
	fmt.Println(string(decoded))
	return nil
}

func CreateKubernetesClient(kubeconfigPath string, client string) (*kubernetes.Clientset, error) {
	// Client creation, dynamic for custom resources, clientset for core resources
	cfg, err := clientcmd.BuildConfigFromFlags("", kubeconfigPath)
	if err != nil {
		log.Fatalf("Errore caricando kubeconfig: %v", err)
	}

	clientset, err := kubernetes.NewForConfig(cfg)
	if err != nil {
		return nil, err
	}
	return clientset, nil

}
